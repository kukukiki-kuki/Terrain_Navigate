/*
	Example: A TransitCost calculation FIS (fuzzy inference system)
	Calculates TransitCost based on 'slope','fluctuation','friction','mellowness'

*/

FUNCTION_BLOCK TransitCost	// Block definition (there may be more than one block per file)

// Define input variables
VAR_INPUT
	slope : REAL;
	fluctuation : REAL;
	friction : REAL;
	mellowness : REAL;
END_VAR

// Define output variable
VAR_OUTPUT
	TransitCost : REAL;
END_VAR

// Fuzzify input variable 'slope': {'flat', 'relief', 'cragginess'}
FUZZIFY slope
	TERM flat :=(0, 1) (5, 1) (15, 0) ;
	TERM relief := (10, 0) (15,1) (20 ,0);
	TERM cragginess := (15, 0) (25, 1)(30, 1);
END_FUZZIFY

// Fuzzify input variable 'fluctuation': { 'gentle', 'moderate','high'}
FUZZIFY fluctuation
	TERM gentle := (0, 1) (0.5, 1) (1.5, 0) ;
	TERM moderate := (1, 0) (1.75,1) (2.5, 0);
	TERM high := (2, 0) (3, 1) (3.5, 1);
END_FUZZIFY

// Fuzzify input variable 'friction': { 'slippy', 'coarse','roughness'}
FUZZIFY friction
	TERM slippy := (0, 1) (0.2, 1) (0.4, 0);
	TERM coarse := (0.2, 0) (0.4, 1) (0.6, 1) (0.8, 0);
	TERM roughness := (0.6, 0) (0.8, 1) (1, 1);
END_FUZZIFY

// Fuzzify input variable 'mellowness': { 'stiff', 'slight','soft'}
FUZZIFY mellowness
	TERM stiff := (0, 1) (0.2, 1) (0.4, 0);
	TERM slight := (0.2, 0) (0.5, 1) (0.8, 0);
	TERM soft := (0.6, 0) (0.8, 1) (1, 1);
END_FUZZIFY

// Defzzzify output variable 'TransitCost' : {'safe','lowRisk','mediumRisk','risk' }
DEFUZZIFY TransitCost
	TERM safe := (0, 1) (0.2, 1) (0.4, 0);
	TERM lowRisk := (0.2, 0) (0.4, 1) (0.6, 0);
	TERM mediumRisk := (0.4, 0) (0.6, 1) (0.8, 0);
	TERM risk := (0.6, 0) (0.8, 1) (1, 1);
	METHOD : COG;		// Use 'Center Of Gravity' defuzzification method
	DEFAULT := 0.5;		// Default value is 0 (if no rule activates defuzzifier)
END_DEFUZZIFY

// Inference rules
RULEBLOCK No1
	AND : MIN;	// Use 'min' for 'and'
	ACT : MIN;	// Use 'min' activation method
    ACCU : MAX;	// Use 'max' accumulation method


	RULE 1: IF slope IS flat AND fluctuation IS gentle AND friction IS slippy AND mellowness IS stiff THEN TransitCost IS lowRisk;
	RULE 2: IF slope IS flat AND fluctuation IS gentle AND friction IS slippy AND mellowness IS slight THEN TransitCost IS safe;
	RULE 3: IF slope IS flat AND fluctuation IS gentle AND friction IS slippy AND mellowness IS soft THEN TransitCost IS risk;
	RULE 4: IF slope IS flat AND fluctuation IS gentle AND friction IS coarse AND mellowness IS stiff THEN TransitCost IS safe;
	RULE 5: IF slope IS flat AND fluctuation IS gentle AND friction IS coarse AND mellowness IS slight THEN TransitCost IS mediumRisk;
	RULE 6: IF slope IS flat AND fluctuation IS gentle AND friction IS coarse AND mellowness IS soft THEN TransitCost IS risk;
	RULE 7: IF slope IS flat AND fluctuation IS gentle AND friction IS roughness AND mellowness IS stiff THEN TransitCost IS safe;
	RULE 8: IF slope IS flat AND fluctuation IS gentle AND friction IS roughness AND mellowness IS slight THEN TransitCost IS lowRisk;
	RULE 9: IF slope IS flat AND fluctuation IS gentle AND friction IS roughness AND mellowness IS soft THEN TransitCost IS mediumRisk;
	RULE 10: IF slope IS flat AND fluctuation IS moderate AND friction IS slippy AND mellowness IS stiff THEN TransitCost IS lowRisk;
	RULE 11: IF slope IS flat AND fluctuation IS moderate AND friction IS slippy AND mellowness IS slight THEN TransitCost IS mediumRisk;
	RULE 12: IF slope IS flat AND fluctuation IS moderate AND friction IS slippy AND mellowness IS soft THEN TransitCost IS risk;
	RULE 13: IF slope IS flat AND fluctuation IS moderate AND friction IS coarse AND mellowness IS stiff THEN TransitCost IS safe;
	RULE 14: IF slope IS flat AND fluctuation IS moderate AND friction IS coarse AND mellowness IS slight THEN TransitCost IS lowRisk;
	RULE 15: IF slope IS flat AND fluctuation IS moderate AND friction IS coarse AND mellowness IS soft THEN TransitCost IS mediumRisk;
	RULE 16: IF slope IS flat AND fluctuation IS moderate AND friction IS roughness AND mellowness IS stiff THEN TransitCost IS safe;
	RULE 17: IF slope IS flat AND fluctuation IS moderate AND friction IS roughness AND mellowness IS slight THEN TransitCost IS safe;
	RULE 18: IF slope IS flat AND fluctuation IS moderate AND friction IS roughness AND mellowness IS soft THEN TransitCost IS lowRisk;
	RULE 19: IF slope IS flat AND fluctuation IS high AND friction IS slippy AND mellowness IS stiff THEN TransitCost IS lowRisk;
	RULE 20: IF slope IS flat AND fluctuation IS high AND friction IS slippy AND mellowness IS slight THEN TransitCost IS lowRisk;
	RULE 21: IF slope IS flat AND fluctuation IS high AND friction IS slippy AND mellowness IS soft THEN TransitCost IS risk;
	RULE 22: IF slope IS flat AND fluctuation IS high AND friction IS coarse AND mellowness IS stiff THEN TransitCost IS safe;
	RULE 23: IF slope IS flat AND fluctuation IS high AND friction IS coarse AND mellowness IS slight THEN TransitCost IS lowRisk;
	RULE 24: IF slope IS flat AND fluctuation IS high AND friction IS coarse AND mellowness IS soft THEN TransitCost IS mediumRisk;
	RULE 25: IF slope IS flat AND fluctuation IS high AND friction IS roughness AND mellowness IS stiff THEN TransitCost IS safe;
	RULE 26: IF slope IS flat AND fluctuation IS high AND friction IS roughness AND mellowness IS slight THEN TransitCost IS lowRisk;
	RULE 27: IF slope IS flat AND fluctuation IS high AND friction IS roughness AND mellowness IS soft THEN TransitCost IS mediumRisk;
	RULE 28: IF slope IS relief AND fluctuation IS gentle AND friction IS slippy AND mellowness IS stiff THEN TransitCost IS lowRisk;
	RULE 29: IF slope IS relief AND fluctuation IS gentle AND friction IS slippy AND mellowness IS slight THEN TransitCost IS lowRisk;
	RULE 30: IF slope IS relief AND fluctuation IS gentle AND friction IS slippy AND mellowness IS soft THEN TransitCost IS mediumRisk;
	RULE 31: IF slope IS relief AND fluctuation IS gentle AND friction IS coarse AND mellowness IS stiff THEN TransitCost IS safe;
	RULE 32: IF slope IS relief AND fluctuation IS gentle AND friction IS coarse AND mellowness IS slight THEN TransitCost IS lowRisk;
	RULE 33: IF slope IS relief AND fluctuation IS gentle AND friction IS coarse AND mellowness IS soft THEN TransitCost IS mediumRisk;
	RULE 34: IF slope IS relief AND fluctuation IS gentle AND friction IS roughness AND mellowness IS stiff THEN TransitCost IS lowRisk;
	RULE 35: IF slope IS relief AND fluctuation IS gentle AND friction IS roughness AND mellowness IS slight THEN TransitCost IS lowRisk;
	RULE 36: IF slope IS relief AND fluctuation IS gentle AND friction IS roughness AND mellowness IS soft THEN TransitCost IS mediumRisk;
	RULE 37: IF slope IS relief AND fluctuation IS moderate AND friction IS slippy AND mellowness IS stiff THEN TransitCost IS lowRisk;
	RULE 38: IF slope IS relief AND fluctuation IS moderate AND friction IS slippy AND mellowness IS slight THEN TransitCost IS mediumRisk;
	RULE 39: IF slope IS relief AND fluctuation IS moderate AND friction IS slippy AND mellowness IS soft THEN TransitCost IS risk;
	RULE 40: IF slope IS relief AND fluctuation IS moderate AND friction IS coarse AND mellowness IS stiff THEN TransitCost IS lowRisk;
	RULE 41: IF slope IS relief AND fluctuation IS moderate AND friction IS coarse AND mellowness IS slight THEN TransitCost IS lowRisk;
	RULE 42: IF slope IS relief AND fluctuation IS moderate AND friction IS coarse AND mellowness IS soft THEN TransitCost IS mediumRisk;
	RULE 43: IF slope IS relief AND fluctuation IS moderate AND friction IS roughness AND mellowness IS stiff THEN TransitCost IS lowRisk;
	RULE 44: IF slope IS relief AND fluctuation IS moderate AND friction IS roughness AND mellowness IS slight THEN TransitCost IS lowRisk;
	RULE 45: IF slope IS relief AND fluctuation IS moderate AND friction IS roughness AND mellowness IS soft THEN TransitCost IS mediumRisk;
	RULE 46: IF slope IS relief AND fluctuation IS high AND friction IS slippy AND mellowness IS stiff THEN TransitCost IS mediumRisk;
	RULE 47: IF slope IS relief AND fluctuation IS high AND friction IS slippy AND mellowness IS slight THEN TransitCost IS lowRisk;
	RULE 48: IF slope IS relief AND fluctuation IS high AND friction IS slippy AND mellowness IS soft THEN TransitCost IS risk;
	RULE 49: IF slope IS relief AND fluctuation IS high AND friction IS coarse AND mellowness IS stiff THEN TransitCost IS lowRisk;
	RULE 50: IF slope IS relief AND fluctuation IS high AND friction IS coarse AND mellowness IS slight THEN TransitCost IS mediumRisk;
	RULE 51: IF slope IS relief AND fluctuation IS high AND friction IS coarse AND mellowness IS soft THEN TransitCost IS risk;
	RULE 52: IF slope IS relief AND fluctuation IS high AND friction IS roughness AND mellowness IS stiff THEN TransitCost IS lowRisk;
	RULE 53: IF slope IS relief AND fluctuation IS high AND friction IS roughness AND mellowness IS slight THEN TransitCost IS mediumRisk;
	RULE 54: IF slope IS relief AND fluctuation IS high AND friction IS roughness AND mellowness IS soft THEN TransitCost IS risk;
	RULE 55: IF slope IS cragginess AND fluctuation IS gentle AND friction IS slippy AND mellowness IS stiff THEN TransitCost IS mediumRisk;
	RULE 56: IF slope IS cragginess AND fluctuation IS gentle AND friction IS slippy AND mellowness IS slight THEN TransitCost IS risk;
	RULE 57: IF slope IS cragginess AND fluctuation IS gentle AND friction IS slippy AND mellowness IS soft THEN TransitCost IS risk;
	RULE 58: IF slope IS cragginess AND fluctuation IS gentle AND friction IS coarse AND mellowness IS stiff THEN TransitCost IS mediumRisk;
	RULE 59: IF slope IS cragginess AND fluctuation IS gentle AND friction IS coarse AND mellowness IS slight THEN TransitCost IS mediumRisk;
	RULE 60: IF slope IS cragginess AND fluctuation IS gentle AND friction IS coarse AND mellowness IS soft THEN TransitCost IS risk;
	RULE 61: IF slope IS cragginess AND fluctuation IS gentle AND friction IS roughness AND mellowness IS stiff THEN TransitCost IS lowRisk;
	RULE 62: IF slope IS cragginess AND fluctuation IS gentle AND friction IS roughness AND mellowness IS slight THEN TransitCost IS mediumRisk;
	RULE 63: IF slope IS cragginess AND fluctuation IS gentle AND friction IS roughness AND mellowness IS soft THEN TransitCost IS risk;
	RULE 64: IF slope IS cragginess AND fluctuation IS moderate AND friction IS slippy AND mellowness IS stiff THEN TransitCost IS risk;
	RULE 65: IF slope IS cragginess AND fluctuation IS moderate AND friction IS slippy AND mellowness IS slight THEN TransitCost IS risk;
	RULE 66: IF slope IS cragginess AND fluctuation IS moderate AND friction IS slippy AND mellowness IS soft THEN TransitCost IS risk;
	RULE 67: IF slope IS cragginess AND fluctuation IS moderate AND friction IS coarse AND mellowness IS stiff THEN TransitCost IS mediumRisk;
	RULE 68: IF slope IS cragginess AND fluctuation IS moderate AND friction IS coarse AND mellowness IS slight THEN TransitCost IS mediumRisk;
	RULE 69: IF slope IS cragginess AND fluctuation IS moderate AND friction IS coarse AND mellowness IS soft THEN TransitCost IS risk;
	RULE 70: IF slope IS cragginess AND fluctuation IS moderate AND friction IS roughness AND mellowness IS stiff THEN TransitCost IS mediumRisk;
	RULE 71: IF slope IS cragginess AND fluctuation IS moderate AND friction IS roughness AND mellowness IS slight THEN TransitCost IS mediumRisk;
	RULE 72: IF slope IS cragginess AND fluctuation IS moderate AND friction IS roughness AND mellowness IS soft THEN TransitCost IS risk;
	RULE 73: IF slope IS cragginess AND fluctuation IS high AND friction IS slippy AND mellowness IS stiff THEN TransitCost IS risk;
	RULE 74: IF slope IS cragginess AND fluctuation IS high AND friction IS slippy AND mellowness IS slight THEN TransitCost IS risk;
	RULE 75: IF slope IS cragginess AND fluctuation IS high AND friction IS slippy AND mellowness IS soft THEN TransitCost IS risk;
	RULE 76: IF slope IS cragginess AND fluctuation IS high AND friction IS coarse AND mellowness IS stiff THEN TransitCost IS mediumRisk;
	RULE 77: IF slope IS cragginess AND fluctuation IS high AND friction IS coarse AND mellowness IS slight THEN TransitCost IS mediumRisk;
	RULE 78: IF slope IS cragginess AND fluctuation IS high AND friction IS coarse AND mellowness IS soft THEN TransitCost IS risk;
	RULE 79: IF slope IS cragginess AND fluctuation IS high AND friction IS roughness AND mellowness IS stiff THEN TransitCost IS mediumRisk;
	RULE 80: IF slope IS cragginess AND fluctuation IS high AND friction IS roughness AND mellowness IS slight THEN TransitCost IS mediumRisk;
	RULE 81: IF slope IS cragginess AND fluctuation IS high AND friction IS roughness AND mellowness IS soft THEN TransitCost IS risk;

END_RULEBLOCK

END_FUNCTION_BLOCK